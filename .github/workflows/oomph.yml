name: oomph

on:
  push:
  pull_request:
    branches:
      - main

permissions:
  contents: read
  packages: write

jobs:
  test-oomph:
    uses: ./.github/workflows/common.yml
    strategy:
      matrix:
        #package-version: ['0.3.0', 'main']
        package-version: ['main']
        #backend: ['mpi', 'ucx', 'libfabric']
        backend: ['mpi']
        fortran-bindings: [false]
        device: ['cpu']
    with:
      package-name: oomph
      package-version: ${{ matrix.package-version }}
      package-variants: >-
        backend=${{ matrix.backend }}
        ${{ matrix.fortran-bindings && '+fortran-bindings' || '' }}
        ${{ matrix.device == 'cuda' && '+cuda' || '' }}
        ${{ matrix.device == 'rocm' && '+rocm' || '' }}
      test-package: ${{ matrix.device == 'cpu' }}
